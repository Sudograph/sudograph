<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Existing project - Sudograph</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="sudograph.html"><strong aria-hidden="true">1.</strong> Sudograph</a></li><li class="chapter-item expanded "><a href="examples.html"><strong aria-hidden="true">2.</strong> Examples</a></li><li class="chapter-item expanded "><a href="quickest-of-quick-starts.html"><strong aria-hidden="true">3.</strong> Quickest of quick starts</a></li><li class="chapter-item expanded "><a href="quick-start.html"><strong aria-hidden="true">4.</strong> Quick start</a></li><li class="chapter-item expanded "><a href="existing-project.html" class="active"><strong aria-hidden="true">5.</strong> Existing project</a></li><li class="chapter-item expanded "><a href="local-deployment.html"><strong aria-hidden="true">6.</strong> Local deployment</a></li><li class="chapter-item expanded "><a href="ic-deployment.html"><strong aria-hidden="true">7.</strong> IC deployment</a></li><li class="chapter-item expanded "><a href="wasm-binary-optimization.html"><strong aria-hidden="true">8.</strong> Wasm binary optimization</a></li><li class="chapter-item expanded "><a href="sudograph-client.html"><strong aria-hidden="true">9.</strong> Sudograph Client</a></li><li class="chapter-item expanded "><a href="agent-js.html"><strong aria-hidden="true">10.</strong> agent-js</a></li><li class="chapter-item expanded "><a href="schema.html"><strong aria-hidden="true">11.</strong> Schema</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="schema-scalars.html"><strong aria-hidden="true">11.1.</strong> Scalars</a></li><li class="chapter-item expanded "><a href="schema-objects.html"><strong aria-hidden="true">11.2.</strong> Objects</a></li><li class="chapter-item expanded "><a href="schema-relations.html"><strong aria-hidden="true">11.3.</strong> Relations</a></li><li class="chapter-item expanded "><a href="schema-custom-scalars.html"><strong aria-hidden="true">11.4.</strong> Custom scalars</a></li><li class="chapter-item expanded "><a href="schema-custom-resolvers.html"><strong aria-hidden="true">11.5.</strong> Custom resolvers</a></li><li class="chapter-item expanded "><a href="schema-custom-directives.html"><strong aria-hidden="true">11.6.</strong> Custom directives</a></li><li class="chapter-item expanded "><a href="schema-sudograph-directives.html"><strong aria-hidden="true">11.7.</strong> Sudograph directives</a></li><li class="chapter-item expanded "><a href="schema-sudograph-settings.html"><strong aria-hidden="true">11.8.</strong> Sudograph settings</a></li></ol></li><li class="chapter-item expanded "><a href="generated-schema.html"><strong aria-hidden="true">12.</strong> Generated schema</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="generated-schema-query.html"><strong aria-hidden="true">12.1.</strong> Query</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="generated-schema-query-read.html"><strong aria-hidden="true">12.1.1.</strong> read</a></li></ol></li><li class="chapter-item expanded "><a href="generated-schema-mutation.html"><strong aria-hidden="true">12.2.</strong> Mutation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="generated-schema-mutation-create.html"><strong aria-hidden="true">12.2.1.</strong> create</a></li><li class="chapter-item expanded "><a href="generated-schema-mutation-update.html"><strong aria-hidden="true">12.2.2.</strong> update</a></li><li class="chapter-item expanded "><a href="generated-schema-mutation-delete.html"><strong aria-hidden="true">12.2.3.</strong> delete</a></li></ol></li><li class="chapter-item expanded "><a href="generated-schema-subscription.html"><strong aria-hidden="true">12.3.</strong> Subscription</a></li><li class="chapter-item expanded "><a href="generated-schema-search.html"><strong aria-hidden="true">12.4.</strong> Search</a></li><li class="chapter-item expanded "><a href="generated-schema-limit.html"><strong aria-hidden="true">12.5.</strong> Limit</a></li><li class="chapter-item expanded "><a href="generated-schema-offset.html"><strong aria-hidden="true">12.6.</strong> Offset</a></li><li class="chapter-item expanded "><a href="generated-schema-order.html"><strong aria-hidden="true">12.7.</strong> Order</a></li></ol></li><li class="chapter-item expanded "><a href="custom-database-operations.html"><strong aria-hidden="true">13.</strong> Custom database operations</a></li><li class="chapter-item expanded "><a href="migrations.html"><strong aria-hidden="true">14.</strong> Migrations</a></li><li class="chapter-item expanded "><a href="transactions.html"><strong aria-hidden="true">15.</strong> Transactions</a></li><li class="chapter-item expanded "><a href="authorization.html"><strong aria-hidden="true">16.</strong> Authorization</a></li><li class="chapter-item expanded "><a href="vision.html"><strong aria-hidden="true">17.</strong> Vision</a></li><li class="chapter-item expanded "><a href="limitations.html"><strong aria-hidden="true">18.</strong> Limitations</a></li><li class="chapter-item expanded "><a href="multi-canister-scaling.html"><strong aria-hidden="true">19.</strong> Multi-canister scaling</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Sudograph</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="existing-project"><a class="header" href="#existing-project">Existing project</a></h1>
<p>The <a href="./quickest-of-quick-starts.html">quickest of quick starts</a> and <a href="./quick-start.html">quick start</a> are both designed to get you started with an entire example project from scratch. If instead you wish to integrate Sudograph into an existing project, this section will help you to achieve that.</p>
<p>Basically you need to add a new Rust canister to your project and import and call the <code>graphql_database</code> procedural macro. If you're new to developing for the Internet Computer, you might want to check the <a href="https://sdk.dfinity.org/docs/quickstart/quickstart-intro.html">documentation</a> to get familiar with canister development. The detailed steps are listed out below, but looking at <a href="./examples.html">examples</a> might also help a lot.</p>
<p>Make sure you at least have Rust, the wasm32-unknown-unknown Rust compilation target, and dfx 0.7.2 installed on your system. If you need help setting all of that up, look at the <a href="http://localhost:3000/quick-start.html#prerequisites">prerequisites section of the quick start</a>.</p>
<p>There are a few basic steps to integrate Sudograph into an existing project:</p>
<ul>
<li>Edit <code>dfx.json</code> in root directory</li>
<li>Add <code>Cargo.toml</code> to root directory</li>
<li>Create <code>graphql canister</code> crate</li>
<li>Create GraphQL schema</li>
<li>Import and call the <code>graphql_database</code> procedural macro</li>
<li>Create candid file</li>
<li>Deploy</li>
</ul>
<h2 id="edit-dfxjson-in-root-directory"><a class="header" href="#edit-dfxjson-in-root-directory">Edit dfx.json in root directory</a></h2>
<p>Add a new canister to your <code>dfx.json</code> in the root directory of your project. You can name the canister whatever you'd like, but to keep things simple we'll call the canister <code>graphql</code>. If you have other canisters already defined, just add the <code>graphql</code> canister. The canister defined below assumes a directory structure where there is a directory called <code>canisters</code> to contain each canister. You can change up the directory structure if you'd like, just change all of the paths appropriately.:</p>
<pre><code class="language-json">{
    &quot;canisters&quot;: {
        &quot;graphql&quot;: {
            &quot;type&quot;: &quot;custom&quot;,
            &quot;build&quot;: &quot;cargo build --target wasm32-unknown-unknown --package graphql --release&quot;,
            &quot;candid&quot;: &quot;canisters/graphql/src/graphql.did&quot;,
            &quot;wasm&quot;: &quot;target/wasm32-unknown-unknown/release/graphql.wasm&quot;
        }
    }
}
</code></pre>
<h2 id="add-cargotoml-to-root-directory"><a class="header" href="#add-cargotoml-to-root-directory">Add Cargo.toml to root directory</a></h2>
<p>In the root directory of your project create a <code>Cargo.toml</code> file with the following contents:</p>
<pre><code class="language-toml">[workspace]
members = [
    &quot;canisters/graphql&quot;,
]

[profile.release]
lto = true
opt-level = 'z'
</code></pre>
<p>Again this assumes your project has a <code>canisters</code> directory where the <code>graphql canister</code> will be defined. You can change the directory structure if you wish, just make sure to update this <code>Cargo.toml</code> file.</p>
<h2 id="create-graphql-canister-crate"><a class="header" href="#create-graphql-canister-crate">Create graphql canister crate</a></h2>
<p>Create a new directory within <code>canisters</code> called <code>graphql</code>, and add a <code>Cargo.toml</code> file. It should look like the following:</p>
<pre><code class="language-toml">[package]
name = &quot;graphql&quot;
version = &quot;0.0.0&quot;
edition = &quot;2018&quot;

[lib]
path = &quot;src/graphql.rs&quot;
crate-type = [&quot;cdylib&quot;]

[dependencies]
sudograph = &quot;0.3.0&quot;
ic-cdk = &quot;0.3.0&quot; # TODO this will go away once https://github.com/dfinity/candid/pull/249 is released
</code></pre>
<p>Within the <code>canisters/graphql</code> directory, now create a <code>src</code> directory. The <code>canisters/graphql/src</code> directory will contain your GraphQL schema, the Rust entrypoint to your <code>graphql canister</code>, and your candid file.</p>
<h2 id="create-graphql-schema"><a class="header" href="#create-graphql-schema">Create GraphQL schema</a></h2>
<p>Within the <code>canisters/graphql/src</code> directory, create your <code>schema.graphql</code> file. The following is just an example:</p>
<pre><code class="language-graphql">type User {
    id: ID!
    username: String!
    blogPosts: [BlogPost!]! @relation(name: &quot;User:blogPosts::BlogPost:author&quot;)
}

type BlogPost {
    id: ID!
    publishedAt: Date
    title: String!
    author: User! @relation(name: &quot;User:blogPosts::BlogPost:author&quot;)
}
</code></pre>
<h2 id="import-and-call-the-graphql_database-procedural-macro"><a class="header" href="#import-and-call-the-graphql_database-procedural-macro">Import and call the <code>graphql_database</code> procedural macro</a></h2>
<p>Within the <code>canisters/graphql/src</code> directory, create your <code>graphql.rs</code> file. The file should look like this:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use sudograph::graphql_database;

graphql_database!(&quot;canisters/graphql/src/schema.graphql&quot;);
<span class="boring">}
</span></code></pre></pre>
<p>This simply imports the <code>graphql_database</code> procedural macro from <code>sudograph</code> and then invokes it with the path to your <code>schema.graphql</code> file. This is where the magic happens and the database with CRUD queries and mutations are all generated.</p>
<h2 id="create-candid-file"><a class="header" href="#create-candid-file">Create candid file</a></h2>
<p>Within the <code>canisters/graphql/src</code> directory, create your <code>graphql.did</code> file. The file should look like this:</p>
<pre><code>service : {
    &quot;graphql_query&quot;: (text, text) -&gt; (text) query;
    &quot;graphql_mutation&quot;: (text, text) -&gt; (text);
}
</code></pre>
<p>The generated canister code will have created the two functions defined in <code>graphql.did</code>, but for now you'll need to create the candid file manually. Hopefully in the future it can be generated for you or abstracted away somehow.</p>
<p><code>graphql_query</code> and <code>graphql_mutation</code> both take two parameters. The first parameter is the query or mutation string. The second parameter is a JSON string containing any variables for the query or mutation. Currently the second parameter is required, so just send an empty JSON object string <code>&quot;{}&quot;</code> if no variables are required for the query or mutation.</p>
<p><code>graphql_query</code> and <code>graphql_mutation</code> both return the result of the query or mutation as a JSON string. Whatever client is consuming the query or mutation will then need to parse the JSON string to turn it into a language-level object. The <a href="./sudograph-client.html">Sudograph Client</a> will do this for you in a JavaScript frontend.</p>
<h2 id="deploy"><a class="header" href="#deploy">Deploy</a></h2>
<p>Use the following links for more information about <a href="./local-deployment.html">local deployment</a> and <a href="./ic-deployment.html">IC deployment</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="quick-start.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="local-deployment.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="quick-start.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="local-deployment.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        <script type="text/javascript" src="src/graphql-theme.js"></script>
        

        

    </body>
</html>
